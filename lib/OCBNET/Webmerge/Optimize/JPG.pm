###################################################################################################
# Copyright 2013 by Marcel Greter
# This file is part of Webmerge (GPL3)
###################################################################################################
package OCBNET::Webmerge::Optimize::JPG;
###################################################################################################
use base qw(OCBNET::Webmerge::Optimize::ANY);
###################################################################################################

use strict;
use warnings;

###################################################################################################

BEGIN
{
	# enable optimizer executables if not explicitly disabled
	$ENV{'WEBMERGE_JPEGOPTIM'} = 1 unless exists $ENV{'WEBMERGE_JPEGOPTIM'};
	$ENV{'WEBMERGE_JPEGTRAN'} = 1 unless exists $ENV{'WEBMERGE_JPEGTRAN'};
}

###################################################################################################
use OCBNET::Webmerge qw(options);
###################################################################################################

options('optimize-jpg', 'jpg!', undef);

###################################################################################################

sub jpegoptim
{
	sprintf("--quiet \"%s\"", $_[0]->path);
}

sub jpegtran
{
	sprintf('-copy none -optimize -outfile "%s" "%s"', $_[0]->path, $_[0]->path);
}

###################################################################################################
use OCBNET::Webmerge qw(optimizers);
###################################################################################################

optimizers('jpgopt', 'jpegoptim', \ &jpegoptim, 1) if $ENV{'WEBMERGE_JPEGOPTIM'};
optimizers('jpgopt', 'jpegtran', \ &jpegtran, 2) if $ENV{'WEBMERGE_JPEGTRAN'};

###################################################################################################
###################################################################################################
1;

